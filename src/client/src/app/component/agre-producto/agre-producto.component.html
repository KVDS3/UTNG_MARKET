<h2 class="head">Gestión de Productos</h2>
<div class="container">
  <!-- Lista de productos -->
  <div *ngIf="!isFormVisible">
    <h5 class="head" style="margin-top: 30px">Mis Productos</h5>
    <button (focus)="true" (click)="mostrarProductosDisponibles()" class="button-action">
      Productos Disponibles
    </button>
    <button (click)="mostrarProductosVendidos()" class="button-action">
      Productos Vendidos
    </button>
    <table>
      <thead>
        <tr>
          <th>Imagen</th>
          <th>Nombre</th>
          <th>Cantidad</th>
          <th>Precio</th>
          <th>Descripción</th>
          <th>Categoría</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let producto of productosfiltered">
          <td>
            <img
            [src]="producto.imagen_url"
            alt="{{ producto.nombre_producto }}"
            width="100"
            />
          </td>
          <td>{{ producto.nombre_producto }}</td>
          <td>{{ producto.cantidad_dispo }}</td>
          <td>{{ producto.precio }}</td>
          <td>{{ producto.descripcion }}</td>
          <td>{{ producto.categoria }}</td>
          <td>
            <button (click)="editarProducto(producto)">Editar</button>
            <button (click)="eliminarProducto(producto._id)">Eliminar</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <br />
  <div class="form-group" style="align-items: flex-end; display: flex">
    <button *ngIf="!isFormVisible"
      (click)="mostrarFormulario()"
      class="opener"
      style="margin: auto"
    >
      Agregar Producto
    </button>
  </div>
  

   <!-- Modal para el formulario -->
   <div
   class="container2 form-group"
   *ngIf="isFormVisible"
 >
 <button *ngIf="isFormVisible"
      (click)="cerrarFormulario()"
      style="margin-left: auto; background-color: red; color:white; padding: 10px; border:none; border-radius: 5px; height: auto; font-size: 1rem; cursor: pointer;"
    >
      cnacelar
    </button>
   <form
     (ngSubmit)="onSubmit()"
     enctype="multipart/form-data"
     class="product-form"
   >
     <div class="form-group">
       <label for="id_vendedor">Vendedor:</label>
       <input
         id="id_vendedor"
         [(ngModel)]="vendedor"
         name="vendedor"
         required
         readonly
       />
     </div>
     <div class="form-group">
       <label for="nombre_producto">Nombre del producto:</label>
       <input
         id="nombre_producto"
         [(ngModel)]="producto.nombre_producto"
         name="nombre_producto"
         required
       />
     </div>
     <div class="form-group">
       <label for="cantidad_dispo">Cantidad disponible:</label>
       <input
         id="cantidad_dispo"
         type="number"
         [(ngModel)]="producto.cantidad_dispo"
         name="cantidad_dispo"
         required
       />
     </div>
     <div class="form-group">
       <label for="precio">Precio:</label>
       <input
         id="precio"
         type="number"
         [(ngModel)]="producto.precio"
         name="precio"
         required
       />
     </div>
     <div class="form-group">
       <label for="descripcion">Descripción:</label>
       <input
         id="descripcion"
         [(ngModel)]="producto.descripcion"
         name="descripcion"
         required
       />
     </div>
     <div class="form-group">
       <label for="categoria">Categoría:</label>
       <select
         id="categoria"
         [(ngModel)]="producto.categoria"
         name="categoria"
         required
       >
         <option value="">Seleccione una categoría</option>
         <option value="Tecnologia y Accesorios">
           Tecnologia y Accesorios
         </option>
         <option value="Material de Estudio y Papeleria">
           Material de Estudio y Papeleria
         </option>
         <option value="Ropa y Merchandising universitario">
           Ropa y Merchandising universitario
         </option>
         <option value="Mobiliario y Organizacion">
           Mobiliario y Organizacion
         </option>
       </select>
     </div>
     <div class="form-group">
       <label for="imagen">Imagen del producto:</label>
       <div
         class="file-upload"
         (click)="fileInput.click()"
         (dragover)="onDragOver($event)"
         (drop)="onDrop($event)"
       >
         <input
           #fileInput
           type="file"
           id="imagen"
           (change)="onFileSelected($event)"
           accept="image/*"
           style="display: none"
         />
         <ng-container *ngIf="!previewUrl">
           <span>+</span>
         </ng-container>
         <ng-container *ngIf="previewUrl">
           <img [src]="previewUrl" alt="Vista previa de la imagen" />
         </ng-container>
       </div>
     </div>
     <div class="form-group">
       <button type="submit" class="submit-btn">
         {{ editando ? "Actualizar" : "Agregar" }} producto
       </button>
     </div>
     <div *ngIf="errorMessage" class="alert alert-danger">
       {{ errorMessage }}
     </div>
   </form>
 </div>
</div>
