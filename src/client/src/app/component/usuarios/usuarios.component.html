<h2 class="head">Registro de Usuarios</h2>
<div class="container">
  
  <!-- Formulario para agregar usuario -->
  <form class="register" (ngSubmit)="onSubmit($event)" #form="ngForm">
    <h3 *ngIf="formValid" class="head">Credenciales de Inicio de Sesión</h3>
    
    <!-- Sección de información general -->
    <div *ngIf="!formValid">
      <div class="form-group">
        <label for="nombre">Nombre:</label>
        <input type="text" id="nombre" [(ngModel)]="nombre" name="nombre" class="form-control" required (blur)="nombre ? showNombreWarning = false : showNombreWarning = true">
        <span *ngIf="form.submitted && !nombre || showNombreWarning" class="text-danger">El nombre es obligatorio.</span>
      </div>

      <div class="form-group">
        <label for="correoElectronico">Correo Electrónico:</label>
        <input type="email" id="correoElectronico" [(ngModel)]="correoElectronico" name="correoElectronico" class="form-control" required (blur)="correoElectronico ? showCorreoWarning = false : showCorreoWarning = true">
        <span *ngIf="form.submitted && !correoElectronico || showCorreoWarning" class="text-danger">El correo electrónico es obligatorio.</span>
      </div>

      <div class="form-group">
        <label for="telefono">Teléfono:</label>
        <input type="text" id="telefono" [(ngModel)]="telefono" name="telefono" class="form-control" required (blur)="telefono ? showTelefonoWarning = false : showTelefonoWarning = true">
        <span *ngIf="form.submitted && !telefono || showTelefonoWarning" class="text-danger">El teléfono es obligatorio.</span>
      </div>

      <div class="form-group">
        <label for="direccion">Dirección:</label>
        <input type="text" id="direccion" [(ngModel)]="direccion" name="direccion" class="form-control" required (blur)="direccion ? showDireccionWarning = false : showDireccionWarning = true">
        <span *ngIf="form.submitted && !direccion || showDireccionWarning" class="text-danger">La dirección es obligatoria.</span>
      </div>

      <div class="form-group">
        <label for="rol">Tipo de usuario:</label>
        <select class="form-select" name="rol" id="rol" [(ngModel)]="rol" required (change)="rol ? showRolWarning = false : showRolWarning = true">
          <option class="form-control" value="student">Estudiante</option>
          <option class="form-control" value="shop">Tienda</option>
        </select>
        <span *ngIf="form.submitted && !rol || showRolWarning" class="text-danger">Selecciona un tipo de usuario.</span>
      </div>

      <!-- Campos adicionales para Estudiante -->
      <div *ngIf="rol === 'student'">
        <div class="form-group">
          <label for="controlNumber">Número de Control:</label>
          <input class="form-control" id="controlNumber" type="text" pattern="[0-9]{10}" title="Debe tener 10 dígitos" [(ngModel)]="numeroControl" name="controlNumber" required (blur)="numeroControl ? showControlNumberWarning = false : showControlNumberWarning = true">
          <span *ngIf="form.submitted && !numeroControl || showControlNumberWarning" class="text-danger">El número de control es obligatorio.</span>
        </div>

        <div class="form-group">
          <label for="universidad">Universidad:</label>
          <input class="form-control" id="universidad" type="text" [(ngModel)]="universidad" name="universidad">
        </div>

        <div class="form-group">
          <label for="areaAcademica">Área Académica:</label>
          <input class="form-control" id="areaAcademica" type="text" [(ngModel)]="areaAcademica" name="areaAcademica">
        </div>
      </div>

      <!-- Campos adicionales para Tienda -->
      <div *ngIf="rol === 'shop'">
        <div class="form-group">
          <label for="rfc">RFC Persona Moral:</label>
          <input (input)="validateRFC()" class="form-control" id="rfc" type="text" [(ngModel)]="rfc" name="rfc" pattern="[A-Z0-9]{12}" title="Debe tener 10 caracteres alfanuméricos" (blur)="rfc ? showRFCWarning = false : showRFCWarning = true">
          <span *ngIf="rfcValido && rfcExiste" class="text-success">✔️</span>
          <span *ngIf="validated && (!rfcValido || !rfcExiste)" class="text-danger">
            ❌ El RFC es inválido o no existe
          </span>
        
          <!-- Mensaje obligatorio si se envía el formulario sin RFC -->
          <div *ngIf="form.submitted && !rfc || showRFCWarning" class="text-danger">El RFC es obligatorio.</div>
        </div>

        <div class="form-group">
          <label for="giroComercial">Giro Comercial:</label>
          <input class="form-control" id="giroComercial" type="text" [(ngModel)]="giroComercial" name="giroComercial">
        </div>

        <div class="form-group">
          <label for="representanteLegal">Representante Legal:</label>
          <input class="form-control" id="representanteLegal" type="text" [(ngModel)]="representanteLegal" name="representanteLegal">
        </div>
      </div>

      <br />
      <div class="cont">
        <button type="button" class="btn-primary" (click)="checkForm()" [disabled]="!isVisibleFieldValid()">
          Continuar
        </button>
        <br>
      </div>
    </div>

    <!-- Formulario de credenciales -->
    <div *ngIf="formValid">
      <!-- Nombre de Usuario -->
      <div class="form-group">
        <label for="username">Nombre de Usuario:</label>
        <input type="text" id="username" [(ngModel)]="username" name="username" class="form-control" required (blur)="username ? showUsernameWarning = false : showUsernameWarning = true">
        <div *ngIf="form.submitted && !username || showUsernameWarning" class="text-danger">El nombre de usuario es obligatorio.</div>
      </div>
      
      <!-- Contraseña -->
      <div class="form-group">
        <label for="password">Contraseña:</label>
        <input type="password" id="password" [(ngModel)]="password" name="password" class="form-control" required (blur)="password ? showPasswordWarning = false : showPasswordWarning = true">
        <div *ngIf="showPasswordWarning && !password" class="text-danger">La contraseña es obligatoria.</div>
      </div>

      <!-- Repetir Contraseña -->
      <div class="form-group">
        <label for="confirmPassword">Confirmar Contraseña:</label>
        <input type="password" id="confirmPassword" [(ngModel)]="password2" name="confirmPassword" class="form-control" required (blur)="password2 ? showConfirmPasswordWarning = false : showConfirmPasswordWarning = true">
        <div *ngIf="showConfirmPasswordWarning && !password2" class="text-danger">Confirma tu contraseña.</div>
        <div *ngIf="showConfirmPasswordWarning && password !== password2" class="text-danger">Las contraseñas no coinciden.</div>
      </div>

      <br />
      <div class="cont">
        <button type="submit" class="btn-primary" [disabled]="!form.valid || password !== password2">
          Registrarse
        </button>
        <br>
        <button type="button" class="cancel" (click)="formValid = false">
          Regresar
        </button>
      </div>
    </div>
  </form>
</div>
